<style>
  .week-section {
    margin-bottom: 3rem;
  }
  
  .week-title {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid #333;
    padding-bottom: 0.5rem;
  }
  
  .day-section {
    margin-bottom: 2rem;
    padding: 1rem;
    background-color: #f9f9f9;
    border-radius: 5px;
  }
  
  .day-header {
    font-size: 1.2rem;
    margin-bottom: 1rem;
    font-weight: bold;
  }
  
  .category_durations {
    padding: 0;
  }

  .category_durations span {
    margin-bottom: 0.2rem;
    font-size: 1.5rem;
  }

  .legend-color {
    display: inline-block;
    width: 15px;
    height: 15px;
    margin-right: 5px;
    border-radius: 3px;
  }
  
  .avg-category {
    display: inline-block;
    margin-right: 1.5rem;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
  }
</style>

<h2><%= @startdate.strftime("%Y/%m/%d") %> ~ <%= @enddate.strftime("%Y/%m/%d") %></h2>

<%= form_with url: analyze_week_path, method: :post do %>
  <%= hidden_field_tag :start_date, @startdate %>
  <%= hidden_field_tag :end_date, @enddate %>
  <%= submit_tag 'ä»Šé€±ã‚’ã¾ã¨ã‚ã¦åˆ†æ' %>
<% end %>


<% @pages_thisweek.each do |page| %>
  <div>
    <h3><%= page.date.strftime("%Y/%m/%d %a") %></h3>
    <%= page.content.gsub("\n", "<br>").html_safe %>
  </div>
<% end %>

<h2><%= @lastweek_startdate.strftime("%Y/%m/%d") %> ~ <%= @lastweek_enddate.strftime("%Y/%m/%d") %></h2>

<% @pages_lastweek.each do |page| %>
  <div>
    <h3><%= page.date.strftime("%Y/%m/%d %a") %></h3>
    <%= page.content.gsub("\n", "<br>").html_safe %>
  </div>
<% end %>

<hr>

<div class="week-section">
  <h2 class="week-title">ä»Šé€± (<%= @startdate.strftime("%Y/%m/%d") %> - <%= @enddate.strftime("%Y/%m/%d") %>)</h2>
  
  <% if @thisweek_avg.any? %>
    <div class="week-summary">
      average
      <div>
        <% @thisweek_avg.each do |category, avg_minutes| %>
          <span class="avg-category">
            <div class="legend-color" style="background-color: <%= @categories[category] %>;"></div>
            <%= category %>: <strong><%= "#{(avg_minutes/60).to_i}h#{(avg_minutes%60).to_i}m" %></strong>
          </span>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <% @pages_thisweek.each do |page| %>
    <div class="day-section">
      <div class="day-header">
        <a href="<%= date_path(page.date.strftime("%Y%m%d")) %>">
          <%= page.date.strftime("%Y/%m/%d %a") %>
        </a>
      </div>
      <%= render partial: "records", locals: { page: page } %>
    </div>
  <% end %>
  
  <% if @pages_thisweek.empty? %>
    <p>ä»Šé€±ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
  <% end %>
</div>

<div class="week-section">
  <h2 class="week-title">å…ˆé€± (<%= @lastweek_startdate.strftime("%Y/%m/%d") %> - <%= @lastweek_enddate.strftime("%Y/%m/%d") %>)</h2>
  
  <% if @lastweek_avg.any? %>
    <div class="week-summary">
      <h3>ğŸ“Š ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ä¸€æ—¥å¹³å‡æ™‚é–“</h3>
      <div>
        <% @lastweek_avg.each do |category, avg_minutes| %>
          <span class="avg-category">
            <div class="legend-color" style="background-color: <%= @categories[category] %>;"></div>
            <%= category %>: <strong><%= "#{(avg_minutes/60).to_i}h#{(avg_minutes%60).to_i}m" %></strong>
          </span>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <% @pages_lastweek.each do |page| %>
    <div class="day-section">
      <div class="day-header">
        <a href="<%= date_path(page.date.strftime("%Y%m%d")) %>">
          <%= page.date.strftime("%Y/%m/%d %a") %>
        </a>
      </div>
      <%= render partial: "records", locals: { page: page } %>
    </div>
  <% end %>
  
  <% if @pages_lastweek.empty? %>
    <p>å…ˆé€±ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
  <% end %>
</div>
